!(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lit-element"),require("wgnhs-common"),require("wgnhs-layout")):"function"==typeof define&&define.amd?define(["exports","lit-element","wgnhs-common","wgnhs-layout"],e):e((t=t||self)["wgnhs-pdf"]={},t["wgnhs-common"],t["wgnhs-common"],t["wgnhs-layout"])})(this,function(t,e,s,i){"use strict";const o=window["pdfjs-dist/build/pdf"],r="toggle-pdf-panel";class n{render(t){if(t){let e=document.createElement("canvas");return o.getDocument(t).promise.then(function(t){return t.getPage(1)}).then(function(t){var s=t.getViewport({scale:1}),i=e,o=i.getContext("2d");i.height=s.height,i.width=s.width;var r={canvasContext:o,viewport:s};return t.render(r).promise}).then(function(){return e.toDataURL()})}return Promise.reject(null)}}class a extends e.LitElement{static get properties(){return{pdfsrc:{type:String,attribute:!1},rotate:{type:Number},zoom:{type:Number}}}constructor(){super(),this.cache={},this.renderer=new n,this.rotate=0,this.zoom=1}static get styles(){return[...s.styles,e.css`.container{min-height:10em;width:100%;display:grid;grid-column-template:1fr;grid-gap:var(--border-radius);justify-content:center;overflow:auto}.content{max-width:100%;padding:var(--border-radius);box-sizing:border-box}.controls{display:grid;grid-column-template:1fr;grid-gap:var(--border-radius);position:absolute;top:0;right:var(--border-radius);margin:var(--border-radius);z-index:10}.control{display:flex;justify-content:center;align-items:center;font-size:var(--icon-size-large);color:var(--palette-accent);text-align:center;cursor:pointer;padding:var(--border-radius);background-color:var(--palette-light);border:none;border-radius:50%}.control:hover{color:var(--el-color-hover,var(--palette-900))}[data-closed]{display:none}`]}render(){return e.html`<div class=controls><button class=control @click=${this.hide}><i class=material-icons title=Hide>close</i></button> <button class=control @click=${this.zoomIn} ?disabled=${this.isMaxZoom}><i class=material-icons title="Zoom In">zoom_in</i></button> <button class=control @click=${this.zoomOut} ?disabled=${this.isMinZoom}><i class=material-icons title="Zoom Out">zoom_out</i></button> <button class=control @click=${this.rotateLeft}><i class=material-icons title="Rotate Left">rotate_left</i></button> <button class=control @click=${this.rotateRight}><i class=material-icons title="Rotate Right">rotate_right</i></button></div><app-spinner ?data-closed=${this.imgsrc}></app-spinner><div class=container ?data-closed=${!this.imgsrc}>${this.imageTag}<slot></slot></div>`}get imgsrc(){return this.cache[this.pdfsrc]}static get MOD_ROTATE(){return 4}get rotate(){return this._rotate}set rotate(t){const e=this.rotate;let s=Math.round(t)+a.MOD_ROTATE;this._rotate=s%a.MOD_ROTATE,this.requestUpdate("rotate",e)}rotateLeft(){this.rotate-=1}rotateRight(){this.rotate+=1}static get MAX_ZOOM(){return 3}get isMaxZoom(){return this.zoom>=a.MAX_ZOOM}static get MIN_ZOOM(){return.5}get isMinZoom(){return this.zoom<=a.MIN_ZOOM}get zoom(){return this._zoom}set zoom(t){const e=this.zoom;this._zoom=Math.min(Math.max(t,a.MIN_ZOOM),a.MAX_ZOOM),this.requestUpdate("zoom",e)}zoomIn(){this.zoom+=.25}zoomOut(){this.zoom-=.25}get translate(){let t={x:0,y:0};return this.rotate&&(t.x=1===this.rotate?0:100*this.zoom,t.y=3===this.rotate?0:100*this.zoom),t}get imageTag(){return this.imgsrc?e.html`<img class=content src=${this.imgsrc} style=${this.contentTransform}>`:""}get contentTransform(){let t=this.rotate/a.MOD_ROTATE,e=this.zoom,s=this.translate;return`\n      transform-origin: top left;\n      transform: rotate(${t}turn) translate(-${s.x}%, -${s.y}%) scale(${e})\n      `}show(t){this.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0,detail:{url:t,closed:!1}})),this.pdfsrc=t}hide(){this.pdfsrc=null,this.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0,detail:{closed:!0}}))}_getFromCache(t){return new Promise((e,s)=>{let i=this.cache[t];i?e(i):s("Not in cache")})}request(t){return this._getFromCache(t).catch(()=>this.renderer.render(t).then(e=>(this.cache[t]=e,this.requestUpdate("cache"),e)))}}customElements.define("pdf-view-panel",a);class l extends e.LitElement{static get properties(){return{src:{type:String},panel:{type:Object,attribute:!1},missing:{type:Boolean,attribute:!1}}}constructor(){super(),this.missing=!0,this.alt=!1}static get styles(){return[...s.styles,e.css`.container{display:grid;grid-template-columns:1fr 1fr;grid-gap:var(--border-radius)}[data-closed]{visibility:hidden}`]}render(){return e.html`<div class=container ?data-closed=${this.missing}><button-link href=${this.src} target=_blank download><i slot=content-before class=material-icons title=Download>save_alt</i> <span slot=content><slot name=download-text>Download</slot></span></button-link><app-collapsible @open=${this.toggle} button><span slot=header><slot name=view-text>View</slot></span><i slot=header-after class=material-icons title=View>${this.alt?"chevron_left":"chevron_right"}</i></app-collapsible></div>`}updated(t){(t.has("panel")||t.has("src"))&&(this.handleMissingPDF(),this.panel&&this.src&&this.panel.request(this.src).then(this.handleLoadedPDF.bind(this),this.handleMissingPDF.bind(this)))}toggle(t){this.alt?this.panel.hide():this.panel.show(this.src)}handleMissingPDF(){this.missing||(this.missing=!0)}handleLoadedPDF(){this.missing&&(this.missing=!1)}handleAlt(t){t.detail.url===this.src?this.alt=!0:this.alt=!1,this.requestUpdate()}connectedCallback(){super.connectedCallback(),this.__altHandler=this.handleAlt.bind(this),document.addEventListener(r,this.__altHandler)}disconnectedCallback(){document.removeEventListener(r,this.__altHandler),super.disconnectedCallback()}}customElements.define("pdf-view-button",l),t.PDFViewButton=l,t.PDFViewPanel=a,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=pdf.min.js.map
